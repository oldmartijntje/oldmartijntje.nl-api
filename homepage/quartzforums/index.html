<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuartzForums</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --bs-bg-opacity: 1;
            --bs-body-bg: #0d1117;
            --bs-body-color: #f0f6fc;
        }

        body {
            background-color: var(--bs-body-bg);
            color: var(--bs-body-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
        }

        .navbar-brand {
            font-weight: bold;
            color: #58a6ff !important;
        }

        .card {
            background-color: #161b22;
            border: 1px solid #30363d;
        }

        .btn-primary {
            background-color: #238636;
            border-color: #238636;
        }

        .btn-primary:hover {
            background-color: #2ea043;
            border-color: #2ea043;
        }

        .btn-outline-primary {
            color: #58a6ff;
            border-color: #58a6ff;
        }

        .btn-outline-primary:hover {
            background-color: #58a6ff;
            border-color: #58a6ff;
            color: #0d1117;
        }

        .btn-danger {
            background-color: #da3633;
            border-color: #da3633;
        }

        .btn-danger:hover {
            background-color: #f85149;
            border-color: #f85149;
        }

        .form-control {
            background-color: #0d1117;
            border-color: #30363d;
            color: #f0f6fc;
        }

        .form-control:focus {
            background-color: #0d1117;
            border-color: #58a6ff;
            color: #f0f6fc;
            box-shadow: 0 0 0 0.25rem rgba(88, 166, 255, 0.25);
        }

        .alert-info {
            background-color: #0c2d6b;
            border-color: #1f6feb;
            color: #79c0ff;
        }

        .alert-success {
            background-color: #0f2817;
            border-color: #238636;
            color: #7ee787;
        }

        .alert-danger {
            background-color: #490202;
            border-color: #da3633;
            color: #ffa198;
        }

        .list-group-item {
            background-color: #21262d;
            border-color: #30363d;
            color: #f0f6fc;
        }

        .list-group-item:hover {
            background-color: #30363d;
        }

        .badge {
            background-color: #21262d !important;
            color: #f0f6fc !important;
        }

        .text-muted {
            color: #8b949e !important;
        }

        .message-content {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .message-meta {
            font-size: 0.875rem;
            color: #8b949e;
            margin-bottom: 0.5rem;
        }

        .limbo-message {
            border-left: 4px solid #da3633;
            opacity: 0.7;
        }

        .forum-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .forum-item:hover {
            transform: translateX(4px);
        }

        .loading {
            text-align: center;
            color: #8b949e;
            padding: 2rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #238636, #58a6ff);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .dropdown-menu {
            background-color: #161b22;
            border-color: #30363d;
        }

        .dropdown-item {
            color: #f0f6fc;
        }

        .dropdown-item:hover {
            background-color: #21262d;
            color: #f0f6fc;
        }

        .nav-tabs .nav-link {
            color: #8b949e;
            border-color: transparent;
        }

        .nav-tabs .nav-link.active {
            color: #f0f6fc;
            background-color: #21262d;
            border-color: #30363d #30363d #21262d;
        }

        .toast {
            background-color: #161b22;
            border: 1px solid #30363d;
        }

        .toast-body {
            color: #f0f6fc;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        .page {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-content {
            animation: slideIn 0.2s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .btn {
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .card {
            transition: all 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .navbar {
            backdrop-filter: blur(10px);
        }

        .modal-content {
            border: 1px solid #30363d;
        }

        .form-control:focus {
            transform: translateY(-1px);
        }

        .list-group-item.forum-item:hover {
            border-color: #58a6ff;
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        .text-primary {
            color: #58a6ff !important;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showHome()">
                <i class="bi bi-chat-square-dots"></i> QuartzForums
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showRecentForums()">Recent Forums</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showAllForums()">Browse All</a>
                    </li>
                </ul>
                <ul class="navbar-nav" id="authNav">
                    <!-- Auth items will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Toast Container -->
        <div class="toast-container position-fixed top-0 end-0 p-3">
            <div id="toast" class="toast" role="alert">
                <div class="toast-header">
                    <strong class="me-auto">QuartzForums</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body" id="toastBody"></div>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="text-center mb-5">
                        <h1 class="display-4 mb-3">
                            <i class="bi bi-chat-square-dots text-primary"></i> QuartzForums
                        </h1>
                        <p class="lead">A modern forum system for the web</p>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-clock-history text-primary fs-1 mb-3"></i>
                                    <h5 class="card-title">Recent Forums</h5>
                                    <p class="card-text">Browse the most recently active forums and join ongoing
                                        discussions.</p>
                                    <button class="btn btn-primary" onclick="showRecentForums()">View Recent</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="bi bi-grid-3x3-gap text-primary fs-1 mb-3"></i>
                                    <h5 class="card-title">Browse All Forums</h5>
                                    <p class="card-text">Explore all available forums across different websites and
                                        topics.</p>
                                    <button class="btn btn-primary" onclick="showAllForums()">Browse All</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-5" id="userWelcome" style="display: none;">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Welcome back!</h5>
                                <p class="card-text">You're logged in and ready to participate in discussions.</p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary" onclick="showUserProfile()">My
                                        Profile</button>
                                    <button class="btn btn-outline-secondary" onclick="logout()">Logout</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-5" id="guestWelcome">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Join the Community</h5>
                                <p class="card-text">Create an account or log in to start participating in discussions.
                                </p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary"
                                        onclick="showAuthModal('register')">Register</button>
                                    <button class="btn btn-outline-primary"
                                        onclick="showAuthModal('login')">Login</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Forums Page -->
        <div id="recentForumsPage" class="page" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-clock-history"></i> Recent Forums</h2>
                <button class="btn btn-outline-secondary" onclick="showHome()">
                    <i class="bi bi-house"></i> Home
                </button>
            </div>
            <div id="recentForumsList">
                <div class="loading">
                    <i class="bi bi-arrow-clockwise spin"></i> Loading recent forums...
                </div>
            </div>
        </div>

        <!-- All Forums Page -->
        <div id="allForumsPage" class="page" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-grid-3x3-gap"></i> All Forums</h2>
                <button class="btn btn-outline-secondary" onclick="showHome()">
                    <i class="bi bi-house"></i> Home
                </button>
            </div>

            <!-- Search and Filter -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="forumSearch" placeholder="Search forums...">
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="implementationKeyFilter">
                        <option value="">All Websites</option>
                    </select>
                </div>
            </div>

            <div id="allForumsList">
                <div class="loading">
                    <i class="bi bi-arrow-clockwise spin"></i> Loading all forums...
                </div>
            </div>

            <!-- Pagination -->
            <nav id="forumsPagination" style="display: none;">
                <ul class="pagination justify-content-center">
                    <!-- Pagination items will be generated by JavaScript -->
                </ul>
            </nav>
        </div>

        <!-- Forum View Page -->
        <div id="forumViewPage" class="page" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 id="forumTitle"><i class="bi bi-chat-square-text"></i> Forum</h2>
                    <small class="text-muted" id="forumMeta"></small>
                </div>
                <div>
                    <button class="btn btn-outline-secondary me-2" onclick="goBack()">
                        <i class="bi bi-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-outline-info me-2" onclick="visitOriginalWebsite()" id="originalWebsiteBtn" style="display: none;">
                        <i class="bi bi-box-arrow-up-right"></i> View on Original Site
                    </button>
                    <button class="btn btn-primary" onclick="showPostMessageModal()" id="postMessageBtn"
                        style="display: none;">
                        <i class="bi bi-plus-lg"></i> Post Message
                    </button>
                </div>
            </div>

            <div id="forumMessages">
                <div class="loading">
                    <i class="bi bi-arrow-clockwise spin"></i> Loading messages...
                </div>
            </div>
        </div>

        <!-- User Profile Page -->
        <div id="userProfilePage" class="page" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-person-circle"></i> User Profile</h2>
                <button class="btn btn-outline-secondary" onclick="showHome()">
                    <i class="bi bi-house"></i> Home
                </button>
            </div>
            <div id="userProfileContent">
                <div class="loading">
                    <i class="bi bi-arrow-clockwise spin"></i> Loading profile...
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalTitle">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="authForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div id="authError" class="alert alert-danger" style="display: none;"></div>
                        <div id="authSuccess" class="alert alert-success" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="authSubmitBtn"
                        onclick="submitAuth()">Login</button>
                    <button type="button" class="btn btn-link" id="authToggleBtn" onclick="toggleAuthMode()">Need an
                        account? Register</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Post Message Modal -->
    <div class="modal fade" id="postMessageModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Post New Message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="postMessageForm">
                        <div class="mb-3">
                            <label for="messageContent" class="form-label">Message</label>
                            <textarea class="form-control" id="messageContent" rows="4"
                                placeholder="Write your message here..." required></textarea>
                            <div class="form-text">Note: Posts containing profanity will be marked and may have limited
                                visibility.</div>
                        </div>
                        <div id="postError" class="alert alert-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitMessage()">Post Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Implementation Key Modal -->
    <div class="modal fade" id="implementationKeyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Enter Implementation Key</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>To post messages, you need an implementation key for your website.</p>
                    <div class="mb-3">
                        <label for="implementationKey" class="form-label">Implementation Key</label>
                        <input type="text" class="form-control" id="implementationKey"
                            placeholder="Enter your implementation key">
                        <div class="form-text">For testing, you can use: <code>test-key-123</code></div>
                    </div>
                    <div class="mb-3">
                        <label for="subpage" class="form-label">Forum Subpage</label>
                        <input type="text" class="form-control" id="subpage" placeholder="/your-forum-name"
                            value="/test-forum">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="setImplementationKey()">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Access Key Modal -->
    <div class="modal fade" id="resetAccessKeyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reset Access Key</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>This will generate a new access key and invalidate your old one. You'll need to update any saved
                        credentials.</p>
                    <form id="resetAccessKeyForm">
                        <div class="mb-3">
                            <label for="resetPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="resetPassword" required>
                        </div>
                        <div id="resetError" class="alert alert-danger" style="display: none;"></div>
                        <div id="resetSuccess" class="alert alert-success" style="display: none;"></div>
                        <div id="newAccessKey" class="alert alert-info" style="display: none;">
                            <strong>Your new access key:</strong><br>
                            <code id="accessKeyDisplay" class="user-select-all"></code>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="copyAccessKey()">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="submitResetAccessKey()">Reset Access
                        Key</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger">Delete Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <strong>Warning!</strong> This action cannot be undone. Your account will be permanently deleted
                        and all your messages will be marked as anonymous.
                    </div>
                    <form id="deleteAccountForm">
                        <div class="mb-3">
                            <label for="deletePassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="deletePassword" required>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                            <label class="form-check-label" for="confirmDelete">
                                I understand this action cannot be undone
                            </label>
                        </div>
                        <div id="deleteError" class="alert alert-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="submitDeleteAccount()">Delete Account</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>

</html>